{"version":3,"file":"setup-context-BSrEM03X.js","sources":["../src/setup-application-context.ts","../src/settled.ts","../src/setup-onerror.ts","../src/setup-context.ts"],"sourcesContent":["import {\n  type BaseContext,\n  getContext,\n  isTestContext,\n  type TestContext,\n} from './setup-context.ts';\nimport hasEmberVersion from './has-ember-version.ts';\nimport settled from './settled.ts';\nimport getTestMetadata from './test-metadata.ts';\nimport { runHooks } from './helper-hooks.ts';\nimport type Router from '@ember/routing/router';\nimport type RouterService from '@ember/routing/router-service';\nimport { assert } from '@ember/debug';\n\nexport interface ApplicationTestContext extends TestContext {\n  element?: Element | null;\n}\n\nconst CAN_USE_ROUTER_EVENTS = hasEmberVersion(3, 6);\nlet routerTransitionsPending: boolean | null = null;\nconst ROUTER = new WeakMap();\nconst HAS_SETUP_ROUTER = new WeakMap();\n\n// eslint-disable-next-line require-jsdoc\nexport function isApplicationTestContext(\n  context: BaseContext,\n): context is ApplicationTestContext {\n  return isTestContext(context);\n}\n\n/**\n  Determines if we have any pending router transitions (used to determine `settled` state)\n\n  @public\n  @returns {(boolean|null)} if there are pending transitions\n*/\nexport function hasPendingTransitions(): boolean | null {\n  if (CAN_USE_ROUTER_EVENTS) {\n    return routerTransitionsPending;\n  }\n\n  const context = getContext();\n\n  // there is no current context, we cannot check\n  if (context === undefined) {\n    return null;\n  }\n\n  const router = ROUTER.get(context);\n\n  if (router === undefined) {\n    // if there is no router (e.g. no `visit` calls made yet), we cannot\n    // check for pending transitions but this is explicitly not an error\n    // condition\n    return null;\n  }\n\n  const routerMicrolib = router._routerMicrolib || router.router;\n\n  if (routerMicrolib === undefined) {\n    return null;\n  }\n\n  return !!routerMicrolib.activeTransition;\n}\n\n/**\n  Setup the current router instance with settledness tracking. Generally speaking this\n  is done automatically (during a `visit('/some-url')` invocation), but under some\n  circumstances (e.g. a non-application test where you manually call `this.owner.setupRouter()`)\n  you may want to call it yourself.\n\n  @public\n */\nexport function setupRouterSettlednessTracking() {\n  const context = getContext();\n  if (context === undefined || !isTestContext(context)) {\n    throw new Error(\n      'Cannot setupRouterSettlednessTracking outside of a test context',\n    );\n  }\n\n  // avoid setting up many times for the same context\n  if (HAS_SETUP_ROUTER.get(context)) {\n    return;\n  }\n  HAS_SETUP_ROUTER.set(context, true);\n\n  const { owner } = context;\n  let router: Router | RouterService;\n  if (CAN_USE_ROUTER_EVENTS) {\n    // SAFETY: unfortunately we cannot `assert` here at present because the\n    // class is not exported, only the type, since it is not designed to be\n    // sub-classed. The most we can do at present is assert that it at least\n    // *exists* and assume that if it does exist, it is bound correctly.\n    const routerService = owner.lookup('service:router');\n    assert('router service is not set up correctly', !!routerService);\n    router = routerService as RouterService;\n\n    // track pending transitions via the public routeWillChange / routeDidChange APIs\n    // routeWillChange can fire many times and is only useful to know when we have _started_\n    // transitioning, we can then use routeDidChange to signal that the transition has settled\n    router.on('routeWillChange', () => (routerTransitionsPending = true));\n    router.on('routeDidChange', () => (routerTransitionsPending = false));\n  } else {\n    // SAFETY: similarly, this cast cannot be made safer because on the versions\n    // where we fall into this path, this is *also* not an exported class.\n    const mainRouter = owner.lookup('router:main');\n    assert('router:main is not available', !!mainRouter);\n    router = mainRouter as Router;\n    ROUTER.set(context, router);\n  }\n\n  // hook into teardown to reset local settledness state\n  const ORIGINAL_WILL_DESTROY = router.willDestroy;\n  router.willDestroy = function () {\n    routerTransitionsPending = null;\n\n    return ORIGINAL_WILL_DESTROY.call(this);\n  };\n}\n\n/**\n  Navigate the application to the provided URL.\n\n  @public\n  @param {string} url The URL to visit (e.g. `/posts`)\n  @param {object} options app boot options\n  @returns {Promise<void>} resolves when settled\n\n  @example\n  <caption>\n    Visiting the route for post 1.\n  </caption>\n  await visit('/posts/1');\n\n  @example\n  <caption>\n    Visiting the route for post 1 while also providing the `rootElement` app boot option.\n  </caption>\n  await visit('/', { rootElement: '#container' });\n*/\nexport function visit(\n  url: string,\n  options?: Record<string, unknown>,\n): Promise<void> {\n  const context = getContext();\n  if (!context || !isApplicationTestContext(context)) {\n    throw new Error(\n      'Cannot call `visit` without having first called `setupApplicationContext`.',\n    );\n  }\n\n  const { owner } = context;\n  const testMetadata = getTestMetadata(context);\n  testMetadata.usedHelpers.push('visit');\n\n  return Promise.resolve()\n    .then(() => {\n      return runHooks('visit', 'start', url, options);\n    })\n    .then(() => {\n      const visitResult = owner.visit(url, options);\n\n      setupRouterSettlednessTracking();\n\n      return visitResult;\n    })\n    .then(() => {\n      context.element = document.querySelector('#ember-testing');\n    })\n    .then(settled)\n    .then(() => {\n      return runHooks('visit', 'end', url, options);\n    });\n}\n\n/**\n  @public\n  @returns {string} the currently active route name\n*/\nexport function currentRouteName(): string {\n  const context = getContext();\n  if (!context || !isApplicationTestContext(context)) {\n    throw new Error(\n      'Cannot call `currentRouteName` without having first called `setupApplicationContext`.',\n    );\n  }\n\n  const router = context.owner.lookup('router:main') as any;\n  const currentRouteName = router.currentRouteName;\n  assert(\n    'currentRouteName should be a string',\n    typeof currentRouteName === 'string',\n  );\n  return currentRouteName;\n}\n\nconst HAS_CURRENT_URL_ON_ROUTER = hasEmberVersion(2, 13);\n\n/**\n  @public\n  @returns {string} the applications current url\n*/\nexport function currentURL(): string {\n  const context = getContext();\n  if (!context || !isApplicationTestContext(context)) {\n    throw new Error(\n      'Cannot call `currentURL` without having first called `setupApplicationContext`.',\n    );\n  }\n\n  const router = context.owner.lookup('router:main') as any;\n\n  if (HAS_CURRENT_URL_ON_ROUTER) {\n    const routerCurrentURL = router.currentURL;\n\n    // SAFETY: this path is a lie for the sake of the public-facing types. The\n    // framework itself sees this path, but users never do. A user who calls the\n    // API without calling `visit()` will see an `UnrecognizedURLError`, rather\n    // than getting back `null`.\n    if (routerCurrentURL === null) {\n      return routerCurrentURL as never as string;\n    }\n\n    assert(\n      `currentUrl should be a string, but was ${typeof routerCurrentURL}`,\n      typeof routerCurrentURL === 'string',\n    );\n\n    return routerCurrentURL;\n  } else {\n    // SAFETY: this is *positively ancient* and should probably be removed at\n    // some point; old routers which don't have `currentURL` *should* have a\n    // `location` with `getURL()` per the docs for 2.12.\n    return (router.location as any).getURL();\n  }\n}\n\n/**\n  Used by test framework addons to setup the provided context for working with\n  an application (e.g. routing).\n\n  `setupContext` must have been run on the provided context prior to calling\n  `setupApplicationContext`.\n\n  Sets up the basic framework used by application tests.\n\n  @public\n  @param {Object} context the context to setup\n  @returns {Promise<void>} resolves when the context is set up\n*/\nexport default function setupApplicationContext(\n  context: TestContext,\n): Promise<void> {\n  const testMetadata = getTestMetadata(context);\n  testMetadata.setupTypes.push('setupApplicationContext');\n\n  return Promise.resolve();\n}\n","// @ts-ignore: this is private API. This import will work Ember 5.1+ since it\n// \"provides\" this public API, but does not for earlier versions. As a result,\n// this type will be `any`.\nimport { _backburner } from '@ember/runloop';\nimport { Test } from 'ember-testing';\nimport { pendingRequests as _internalGetPendingRequestsCount } from 'ember-testing/lib/test/pending_requests';\n\nimport { nextTick } from './-utils.ts';\nimport waitUntil from './wait-until.ts';\nimport { hasPendingTransitions } from './setup-application-context.ts';\nimport { hasPendingWaiters } from '@ember/test-waiters';\nimport type DebugInfo from './-internal/debug-info.ts';\nimport { TestDebugInfo } from './-internal/debug-info.ts';\n\nlet requests: XMLHttpRequest[];\nconst checkWaiters = Test.checkWaiters;\n\n/**\n  @private\n  @returns {number} the count of pending requests\n*/\nfunction pendingRequests() {\n  const localRequestsPending = requests !== undefined ? requests.length : 0;\n  const internalRequestsPending = _internalGetPendingRequestsCount();\n\n  return localRequestsPending + internalRequestsPending;\n}\n\n/**\n  @private\n  @param {Event} event (unused)\n  @param {XMLHTTPRequest} xhr the XHR that has initiated a request\n*/\nfunction incrementAjaxPendingRequests(event: any, xhr: XMLHttpRequest): void {\n  requests.push(xhr);\n}\n\n/**\n  @private\n  @param {Event} event (unused)\n  @param {XMLHTTPRequest} xhr the XHR that has initiated a request\n*/\nfunction decrementAjaxPendingRequests(event: any, xhr: XMLHttpRequest): void {\n  // In most Ember versions to date (current version is 2.16) RSVP promises are\n  // configured to flush in the actions queue of the Ember run loop, however it\n  // is possible that in the future this changes to use \"true\" micro-task\n  // queues.\n  //\n  // The entire point here, is that _whenever_ promises are resolved will be\n  // before the next run of the JS event loop. Then in the next event loop this\n  // counter will decrement. In the specific case of AJAX, this means that any\n  // promises chained off of `$.ajax` will properly have their `.then` called\n  // _before_ this is decremented (and testing continues)\n  nextTick(() => {\n    for (let i = 0; i < requests.length; i++) {\n      if (xhr === requests[i]) {\n        requests.splice(i, 1);\n      }\n    }\n  });\n}\n\n/**\n  Clears listeners that were previously setup for `ajaxSend` and `ajaxComplete`.\n\n  @private\n*/\nexport function _teardownAJAXHooks() {\n  // jQuery will not invoke `ajaxComplete` if\n  //    1. `transport.send` throws synchronously and\n  //    2. it has an `error` option which also throws synchronously\n\n  // We can no longer handle any remaining requests\n  requests = [];\n\n  if (typeof (globalThis as any).jQuery === 'undefined') {\n    return;\n  }\n\n  (globalThis as any)\n    .jQuery(document)\n    .off('ajaxSend', incrementAjaxPendingRequests);\n  (globalThis as any)\n    .jQuery(document)\n    .off('ajaxComplete', decrementAjaxPendingRequests);\n}\n\n/**\n  Sets up listeners for `ajaxSend` and `ajaxComplete`.\n\n  @private\n*/\nexport function _setupAJAXHooks() {\n  requests = [];\n\n  if (typeof (globalThis as any).jQuery === 'undefined') {\n    return;\n  }\n\n  (globalThis as any)\n    .jQuery(document)\n    .on('ajaxSend', incrementAjaxPendingRequests);\n  (globalThis as any)\n    .jQuery(document)\n    .on('ajaxComplete', decrementAjaxPendingRequests);\n}\n\nexport interface SettledState {\n  hasRunLoop: boolean;\n  hasPendingTimers: boolean;\n  hasPendingWaiters: boolean;\n  hasPendingRequests: boolean;\n  hasPendingTransitions: boolean | null;\n  isRenderPending: boolean;\n  pendingRequestCount: number;\n  debugInfo: DebugInfo;\n}\n\n/**\n  Check various settledness metrics, and return an object with the following properties:\n\n  - `hasRunLoop` - Checks if a run-loop has been started. If it has, this will\n    be `true` otherwise it will be `false`.\n  - `hasPendingTimers` - Checks if there are scheduled timers in the run-loop.\n    These pending timers are primarily registered by `Ember.run.schedule`. If\n    there are pending timers, this will be `true`, otherwise `false`.\n  - `hasPendingWaiters` - Checks if any registered test waiters are still\n    pending (e.g. the waiter returns `true`). If there are pending waiters,\n    this will be `true`, otherwise `false`.\n  - `hasPendingRequests` - Checks if there are pending AJAX requests (based on\n    `ajaxSend` / `ajaxComplete` events triggered by `jQuery.ajax`). If there\n    are pending requests, this will be `true`, otherwise `false`.\n  - `hasPendingTransitions` - Checks if there are pending route transitions. If the\n    router has not been instantiated / setup for the test yet this will return `null`,\n    if there are pending transitions, this will be `true`, otherwise `false`.\n  - `pendingRequestCount` - The count of pending AJAX requests.\n  - `debugInfo` - Debug information that's combined with info return from backburner's\n    getDebugInfo method.\n  - `isRenderPending` - Checks if there are any pending render operations. This will be true as long\n    as there are tracked values in the template that have not been rerendered yet.\n\n  @public\n  @returns {Object} object with properties for each of the metrics used to determine settledness\n*/\nexport function getSettledState(): SettledState {\n  const hasPendingTimers = _backburner.hasTimers();\n  const hasRunLoop = Boolean(_backburner.currentInstance);\n  const hasPendingLegacyWaiters = checkWaiters();\n  const hasPendingTestWaiters = hasPendingWaiters();\n  const pendingRequestCount = pendingRequests();\n  const hasPendingRequests = pendingRequestCount > 0;\n  // TODO: Ideally we'd have a function in Ember itself that can synchronously identify whether\n  // or not there are any pending render operations, but this will have to suffice for now\n  const isRenderPending = !!hasRunLoop;\n\n  return {\n    hasPendingTimers,\n    hasRunLoop,\n    hasPendingWaiters: hasPendingLegacyWaiters || hasPendingTestWaiters,\n    hasPendingRequests,\n    hasPendingTransitions: hasPendingTransitions(),\n    isRenderPending,\n    pendingRequestCount,\n    debugInfo: new TestDebugInfo({\n      hasPendingTimers,\n      hasRunLoop,\n      hasPendingLegacyWaiters,\n      hasPendingTestWaiters,\n      hasPendingRequests,\n      isRenderPending,\n    }),\n  };\n}\n\n/**\n  Checks various settledness metrics (via `getSettledState()`) to determine if things are settled or not.\n\n  Settled generally means that there are no pending timers, no pending waiters,\n  no pending AJAX requests, and no current run loop. However, new settledness\n  metrics may be added and used as they become available.\n\n  @public\n  @returns {boolean} `true` if settled, `false` otherwise\n*/\nexport function isSettled(): boolean {\n  const {\n    hasPendingTimers,\n    hasRunLoop,\n    hasPendingRequests,\n    hasPendingWaiters,\n    hasPendingTransitions,\n    isRenderPending,\n  } = getSettledState();\n\n  if (\n    hasPendingTimers ||\n    hasRunLoop ||\n    hasPendingRequests ||\n    hasPendingWaiters ||\n    hasPendingTransitions ||\n    isRenderPending\n  ) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n  Returns a promise that resolves when in a settled state (see `isSettled` for\n  a definition of \"settled state\").\n\n  @public\n  @returns {Promise<void>} resolves when settled\n*/\nexport default function settled(): Promise<void> {\n  return waitUntil(isSettled, { timeout: Infinity }).then(() => {});\n}\n","import { getOnerror, setOnerror } from '@ember/-internals/error-handling';\nimport { type BaseContext, getContext } from './setup-context.ts';\n\nconst cachedOnerror: Map<BaseContext, ((error: Error) => void) | undefined> =\n  new Map();\n\n/**\n * Sets the `Ember.onerror` function for tests. This value is intended to be reset after\n * each test to ensure correct test isolation. To reset, you should simply call `setupOnerror`\n * without an `onError` argument.\n *\n * @public\n * @param {Function} onError the onError function to be set on Ember.onerror\n *\n * @example <caption>Example implementation for `ember-qunit` or `ember-mocha`</caption>\n *\n * import { setupOnerror } from '@ember/test-helpers';\n *\n * test('Ember.onerror is stubbed properly', function(assert) {\n *   setupOnerror(function(err) {\n *     assert.ok(err);\n *   });\n * });\n */\nexport default function setupOnerror(onError?: (error: Error) => void): void {\n  const context = getContext();\n\n  if (!context) {\n    throw new Error('Must setup test context before calling setupOnerror');\n  }\n\n  if (!cachedOnerror.has(context)) {\n    throw new Error(\n      '_cacheOriginalOnerror must be called before setupOnerror. Normally, this will happen as part of your test harness.',\n    );\n  }\n\n  if (typeof onError !== 'function') {\n    onError = cachedOnerror.get(context);\n  }\n\n  setOnerror(onError);\n}\n\n/**\n * Resets `Ember.onerror` to the value it originally was at the start of the test run.\n * If there is no context or cached value this is a no-op.\n *\n * @public\n *\n * @example\n *\n * import { resetOnerror } from '@ember/test-helpers';\n *\n * QUnit.testDone(function() {\n *   resetOnerror();\n * })\n */\nexport function resetOnerror(): void {\n  const context = getContext();\n\n  if (context && cachedOnerror.has(context)) {\n    setOnerror(cachedOnerror.get(context));\n  }\n}\n\n/**\n * Caches the current value of Ember.onerror. When `setupOnerror` is called without a value\n * or when `resetOnerror` is called the value will be set to what was cached here.\n *\n * @private\n * @param {BaseContext} context the text context\n */\nexport function _prepareOnerror(context: BaseContext) {\n  if (cachedOnerror.has(context)) {\n    throw new Error('_prepareOnerror should only be called once per-context');\n  }\n\n  // SAFETY: getOnerror doesn't have correct types\n  cachedOnerror.set(context, getOnerror() as any);\n}\n\n/**\n * Removes the cached value of Ember.onerror.\n *\n * @private\n * @param {BaseContext} context the text context\n */\nexport function _cleanupOnerror(context: BaseContext) {\n  resetOnerror();\n  cachedOnerror.delete(context);\n}\n","// @ts-ignore: this is private API. This import will work Ember 5.1+ since it\n// \"provides\" this public API, but does not for earlier versions. As a result,\n// this type will be `any`.\nimport { _backburner, run } from '@ember/runloop';\nimport { set, setProperties, get, getProperties } from '@ember/object';\nimport type { Resolver } from '@ember/owner';\nimport { setOwner } from '@ember/application';\n\nimport buildOwner, { type Owner } from './build-owner.ts';\nimport { _setupAJAXHooks } from './settled.ts';\nimport { _prepareOnerror } from './setup-onerror.ts';\nimport { setTesting } from '@ember/debug';\nimport {\n  assert,\n  registerDeprecationHandler,\n  registerWarnHandler,\n} from '@ember/debug';\nimport global from './global.ts';\nimport { getResolver } from './resolver.ts';\nimport { getApplication } from './application.ts';\nimport getTestMetadata from './test-metadata.ts';\nimport {\n  getDeprecationsForContext,\n  getDeprecationsDuringCallbackForContext,\n  type DeprecationFailure,\n} from './-internal/deprecations.ts';\nimport {\n  getWarningsForContext,\n  getWarningsDuringCallbackForContext,\n  type Warning,\n} from './-internal/warnings.ts';\n\nexport interface SetupContextOptions {\n  resolver?: Resolver | undefined;\n}\n\n// This handler exists to provide the underlying data to enable the following methods:\n// * getDeprecations()\n// * getDeprecationsDuringCallback()\n// * getDeprecationsDuringCallbackForContext()\nregisterDeprecationHandler((message, options, next) => {\n  const context = getContext();\n  if (context === undefined) {\n    next.apply(null, [message, options]);\n    return;\n  }\n\n  getDeprecationsForContext(context).push({ message, options });\n  next.apply(null, [message, options]);\n});\n\n// This handler exists to provide the underlying data to enable the following methods:\n// * getWarnings()\n// * getWarningsDuringCallback()\n// * getWarningsDuringCallbackForContext()\nregisterWarnHandler((message, options, next) => {\n  const context = getContext();\n  if (context === undefined) {\n    next.apply(null, [message, options]);\n    return;\n  }\n\n  getWarningsForContext(context).push({ message, options });\n  next.apply(null, [message, options]);\n});\n\nexport type BaseContext = object;\n\n/**\n * The public API for the test context, which test authors can depend on being\n * available.\n *\n * Note: this is *not* user-constructible; it becomes available by calling\n * `setupContext()` with a base context object.\n */\nexport interface TestContext extends BaseContext {\n  owner: Owner;\n\n  set<T>(key: string, value: T): T;\n  setProperties<T extends Record<string, unknown>>(hash: T): T;\n  get(key: string): unknown;\n  getProperties(...args: string[]): Record<string, unknown>;\n\n  pauseTest(): Promise<void>;\n  resumeTest(): void;\n}\n\n// eslint-disable-next-line require-jsdoc\nexport function isTestContext(context: BaseContext): context is TestContext {\n  const maybeContext = context as Record<string, unknown>;\n  return (\n    typeof maybeContext['pauseTest'] === 'function' &&\n    typeof maybeContext['resumeTest'] === 'function'\n  );\n}\n\n/**\n  @private\n  @param {Object} it the global object to test\n  @returns {Boolean} it exists\n*/\nfunction check(it: any) {\n  // Math is known to exist as a global in every environment.\n  return it && it.Math === Math && it;\n}\n\nconst globalObject =\n  check(typeof globalThis == 'object' && globalThis) ||\n  check(typeof window === 'object' && window) ||\n  check(typeof self === 'object' && self) ||\n  // @ts-ignore -- global does not exist\n  check(typeof global === 'object' && global);\n\n/**\n  Stores the provided context as the \"global testing context\".\n\n  Generally setup automatically by `setupContext`.\n\n  @public\n  @param {Object} context the context to use\n*/\nexport function setContext(context: BaseContext): void {\n  globalObject.__test_context__ = context;\n}\n\n/**\n  Retrieve the \"global testing context\" as stored by `setContext`.\n\n  @public\n  @returns {Object} the previously stored testing context\n*/\nexport function getContext(): BaseContext | undefined {\n  return globalObject.__test_context__;\n}\n\n/**\n  Clear the \"global testing context\".\n\n  Generally invoked from `teardownContext`.\n\n  @public\n*/\nexport function unsetContext(): void {\n  globalObject.__test_context__ = undefined;\n}\n\n/**\n * Returns a promise to be used to pauses the current test (due to being\n * returned from the test itself).  This is useful for debugging while testing\n * or for test-driving.  It allows you to inspect the state of your application\n * at any point.\n *\n * The test framework wrapper (e.g. `ember-qunit` or `ember-mocha`) should\n * ensure that when `pauseTest()` is used, any framework specific test timeouts\n * are disabled.\n *\n * @public\n * @returns {Promise<void>} resolves _only_ when `resumeTest()` is invoked\n * @example <caption>Usage via ember-qunit</caption>\n *\n * import { setupRenderingTest } from 'ember-qunit';\n * import { render, click, pauseTest } from '@ember/test-helpers';\n *\n *\n * module('awesome-sauce', function(hooks) {\n *   setupRenderingTest(hooks);\n *\n *   test('does something awesome', async function(assert) {\n *     await render(hbs`{{awesome-sauce}}`);\n *\n *     // added here to visualize / interact with the DOM prior\n *     // to the interaction below\n *     await pauseTest();\n *\n *     click('.some-selector');\n *\n *     assert.equal(this.element.textContent, 'this sauce is awesome!');\n *   });\n * });\n */\nexport function pauseTest(): Promise<void> {\n  const context = getContext();\n\n  if (!context || !isTestContext(context)) {\n    throw new Error(\n      'Cannot call `pauseTest` without having first called `setupTest` or `setupRenderingTest`.',\n    );\n  }\n\n  return context.pauseTest();\n}\n\n/**\n  Resumes a test previously paused by `await pauseTest()`.\n\n  @public\n*/\nexport function resumeTest(): void {\n  const context = getContext();\n\n  if (!context || !isTestContext(context)) {\n    throw new Error(\n      'Cannot call `resumeTest` without having first called `setupTest` or `setupRenderingTest`.',\n    );\n  }\n\n  context.resumeTest();\n}\n\n/**\n * Returns deprecations which have occurred so far for a the current test context\n *\n * @public\n * @returns {Array<DeprecationFailure>} An array of deprecation messages\n * @example <caption>Usage via ember-qunit</caption>\n *\n * import { getDeprecations } from '@ember/test-helpers';\n *\n * module('awesome-sauce', function(hooks) {\n *   setupRenderingTest(hooks);\n *\n *   test('does something awesome', function(assert) {\n       const deprecations = getDeprecations() // => returns deprecations which have occurred so far in this test\n *   });\n * });\n */\nexport function getDeprecations(): Array<DeprecationFailure> {\n  const context = getContext();\n\n  if (!context) {\n    throw new Error(\n      '[@ember/test-helpers] could not get deprecations if no test context is currently active',\n    );\n  }\n\n  return getDeprecationsForContext(context);\n}\n\nexport type { DeprecationFailure };\n\n/**\n * Returns deprecations which have occurred so far for a the current test context\n *\n * @public\n * @param {Function} [callback] The callback that when executed will have its DeprecationFailure recorded\n * @returns {Array<DeprecationFailure> | Promise<Array<DeprecationFailure>>} An array of deprecation messages\n * @example <caption>Usage via ember-qunit</caption>\n *\n * import { getDeprecationsDuringCallback } from '@ember/test-helpers';\n *\n * module('awesome-sauce', function(hooks) {\n *   setupRenderingTest(hooks);\n *\n *   test('does something awesome', function(assert) {\n *     const deprecations = getDeprecationsDuringCallback(() => {\n *       // code that might emit some deprecations\n *\n *     }); // => returns deprecations which occurred while the callback was invoked\n *   });\n *\n *\n *   test('does something awesome', async function(assert) {\n *     const deprecations = await getDeprecationsDuringCallback(async () => {\n *       // awaited code that might emit some deprecations\n *     }); // => returns deprecations which occurred while the callback was invoked\n *   });\n * });\n */\nexport function getDeprecationsDuringCallback(\n  callback: () => void,\n): Array<DeprecationFailure> | Promise<Array<DeprecationFailure>> {\n  const context = getContext();\n\n  if (!context) {\n    throw new Error(\n      '[@ember/test-helpers] could not get deprecations if no test context is currently active',\n    );\n  }\n\n  return getDeprecationsDuringCallbackForContext(context, callback);\n}\n\n/**\n * Returns warnings which have occurred so far for a the current test context\n *\n * @public\n * @returns {Array<Warning>} An array of warnings\n * @example <caption>Usage via ember-qunit</caption>\n *\n * import { getWarnings } from '@ember/test-helpers';\n *\n * module('awesome-sauce', function(hooks) {\n *   setupRenderingTest(hooks);\n *\n *   test('does something awesome', function(assert) {\n       const warnings = getWarnings() // => returns warnings which have occurred so far in this test\n *   });\n * });\n */\nexport function getWarnings(): Array<Warning> {\n  const context = getContext();\n\n  if (!context) {\n    throw new Error(\n      '[@ember/test-helpers] could not get warnings if no test context is currently active',\n    );\n  }\n\n  return getWarningsForContext(context);\n}\n\nexport type { Warning };\n\n/**\n * Returns warnings which have occurred so far for a the current test context\n *\n * @public\n * @param {Function} [callback] The callback that when executed will have its warnings recorded\n * @returns {Array<Warning> | Promise<Array<Warning>>} An array of warnings information\n * @example <caption>Usage via ember-qunit</caption>\n *\n * import { getWarningsDuringCallback } from '@ember/test-helpers';\n * import { warn } from '@ember/debug';\n *\n * module('awesome-sauce', function(hooks) {\n *   setupRenderingTest(hooks);\n *\n *   test('does something awesome', function(assert) {\n *     const warnings = getWarningsDuringCallback(() => {\n *     warn('some warning');\n *\n *     }); // => returns warnings which occurred while the callback was invoked\n *   });\n *\n *   test('does something awesome', async function(assert) {\n *     warn('some warning');\n *\n *     const warnings = await getWarningsDuringCallback(async () => {\n *       warn('some other warning');\n *     }); // => returns warnings which occurred while the callback was invoked\n *   });\n * });\n */\nexport function getWarningsDuringCallback(\n  callback: () => void,\n): Array<Warning> | Promise<Array<Warning>> {\n  const context = getContext();\n\n  if (!context) {\n    throw new Error(\n      '[@ember/test-helpers] could not get warnings if no test context is currently active',\n    );\n  }\n\n  return getWarningsDuringCallbackForContext(context, callback);\n}\n\n/**\n  Used by test framework addons to setup the provided context for testing.\n\n  Responsible for:\n\n  - sets the \"global testing context\" to the provided context (`setContext`)\n  - create an owner object and set it on the provided context (e.g. `this.owner`)\n  - setup `this.set`, `this.setProperties`, `this.get`, and `this.getProperties` to the provided context\n  - setting up AJAX listeners\n  - setting up `pauseTest` (also available as `this.pauseTest()`) and `resumeTest` helpers\n\n  @public\n  @param {Object} base the context to setup\n  @param {Object} [options] options used to override defaults\n  @param {Resolver} [options.resolver] a resolver to use for customizing normal resolution\n  @returns {Promise<Object>} resolves with the context that was setup\n*/\nexport default function setupContext<T extends object>(\n  base: T,\n  options: SetupContextOptions = {},\n): Promise<T & TestContext> {\n  const context = base as T & TestContext;\n\n  // SAFETY: this is intimate API *designed* for us to override.\n  setTesting(true);\n  setContext(context);\n\n  const testMetadata = getTestMetadata(context);\n  testMetadata.setupTypes.push('setupContext');\n\n  _backburner.DEBUG = true;\n\n  _prepareOnerror(context);\n\n  return Promise.resolve()\n    .then(() => {\n      const application = getApplication();\n      if (application) {\n        return application.boot().then(() => {});\n      }\n      return;\n    })\n    .then(() => {\n      const { resolver } = options;\n\n      // This handles precedence, specifying a specific option of\n      // resolver always trumps whatever is auto-detected, then we fallback to\n      // the suite-wide registrations\n      //\n      // At some later time this can be extended to support specifying a custom\n      // engine or application...\n      if (resolver) {\n        return buildOwner(null, resolver);\n      }\n\n      return buildOwner(getApplication(), getResolver());\n    })\n    .then((owner) => {\n      Object.defineProperty(context, 'owner', {\n        configurable: true,\n        enumerable: true,\n        value: owner,\n        writable: false,\n      });\n      setOwner(context, owner);\n\n      Object.defineProperty(context, 'set', {\n        configurable: true,\n        enumerable: true,\n        // SAFETY: in all of these `defineProperty` calls, we can't actually guarantee any safety w.r.t. the corresponding field's type in `TestContext`\n        value(key: any, value: any): unknown {\n          const ret = run(function () {\n            return set(context, key, value);\n          });\n          return ret;\n        },\n        writable: false,\n      });\n\n      Object.defineProperty(context, 'setProperties', {\n        configurable: true,\n        enumerable: true,\n        // SAFETY: in all of these `defineProperty` calls, we can't actually guarantee any safety w.r.t. the corresponding field's type in `TestContext`\n        value(hash: any): unknown {\n          const ret = run(function () {\n            return setProperties(context, hash);\n          });\n\n          return ret;\n        },\n        writable: false,\n      });\n\n      Object.defineProperty(context, 'get', {\n        configurable: true,\n        enumerable: true,\n        value(key: string): any {\n          return get(context, key);\n        },\n        writable: false,\n      });\n\n      Object.defineProperty(context, 'getProperties', {\n        configurable: true,\n        enumerable: true,\n        // SAFETY: in all of these `defineProperty` calls, we can't actually guarantee any safety w.r.t. the corresponding field's type in `TestContext`\n        value(...args: any[]): Record<string, unknown> {\n          return getProperties(context, args);\n        },\n        writable: false,\n      });\n\n      let resume: ((value?: void | PromiseLike<void>) => void) | undefined;\n      context['resumeTest'] = function resumeTest() {\n        assert(\n          'Testing has not been paused. There is nothing to resume.',\n          !!resume,\n        );\n        resume();\n        global.resumeTest = resume = undefined;\n      };\n\n      context['pauseTest'] = function pauseTest() {\n        console.info('Testing paused. Use `resumeTest()` to continue.'); // eslint-disable-line no-console\n\n        return new Promise((resolve) => {\n          resume = resolve;\n          global.resumeTest = resumeTest;\n        });\n      };\n\n      _setupAJAXHooks();\n\n      return context;\n    });\n}\n"],"names":["CAN_USE_ROUTER_EVENTS","hasEmberVersion","routerTransitionsPending","ROUTER","WeakMap","HAS_SETUP_ROUTER","isApplicationTestContext","context","isTestContext","hasPendingTransitions","getContext","undefined","router","get","routerMicrolib","_routerMicrolib","activeTransition","setupRouterSettlednessTracking","Error","set","owner","routerService","lookup","assert","on","mainRouter","ORIGINAL_WILL_DESTROY","willDestroy","call","visit","url","options","testMetadata","getTestMetadata","usedHelpers","push","Promise","resolve","then","runHooks","visitResult","element","document","querySelector","settled","currentRouteName","HAS_CURRENT_URL_ON_ROUTER","currentURL","routerCurrentURL","location","getURL","setupApplicationContext","setupTypes","requests","checkWaiters","Test","pendingRequests","localRequestsPending","length","internalRequestsPending","_internalGetPendingRequestsCount","incrementAjaxPendingRequests","event","xhr","decrementAjaxPendingRequests","nextTick","i","splice","_teardownAJAXHooks","globalThis","jQuery","off","_setupAJAXHooks","getSettledState","hasPendingTimers","_backburner","hasTimers","hasRunLoop","Boolean","currentInstance","hasPendingLegacyWaiters","hasPendingTestWaiters","hasPendingWaiters","pendingRequestCount","hasPendingRequests","isRenderPending","debugInfo","TestDebugInfo","isSettled","waitUntil","timeout","Infinity","cachedOnerror","Map","setupOnerror","onError","has","setOnerror","resetOnerror","_prepareOnerror","getOnerror","_cleanupOnerror","delete","registerDeprecationHandler","message","next","apply","getDeprecationsForContext","registerWarnHandler","getWarningsForContext","maybeContext","check","it","Math","globalObject","window","self","global","setContext","__test_context__","unsetContext","pauseTest","resumeTest","getDeprecations","getDeprecationsDuringCallback","callback","getDeprecationsDuringCallbackForContext","getWarnings","getWarningsDuringCallback","getWarningsDuringCallbackForContext","setupContext","base","setTesting","DEBUG","application","getApplication","boot","resolver","buildOwner","getResolver","Object","defineProperty","configurable","enumerable","value","writable","setOwner","key","ret","run","hash","setProperties","args","getProperties","resume","console","info"],"mappings":"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;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS8G,SAASA,GAAkB;AACzC,EAAA,MAAMlH,OAAO,GAAGG,UAAU,EAAE,CAAA;EAE5B,IAAI,CAACH,OAAO,IAAI,CAACC,aAAa,CAACD,OAAO,CAAC,EAAE;AACvC,IAAA,MAAM,IAAIW,KAAK,CACb,0FACF,CAAC,CAAA;AACH,GAAA;AAEA,EAAA,OAAOX,OAAO,CAACkH,SAAS,EAAE,CAAA;AAC5B,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACO,SAASC,UAAUA,GAAS;AACjC,EAAA,MAAMnH,OAAO,GAAGG,UAAU,EAAE,CAAA;EAE5B,IAAI,CAACH,OAAO,IAAI,CAACC,aAAa,CAACD,OAAO,CAAC,EAAE;AACvC,IAAA,MAAM,IAAIW,KAAK,CACb,2FACF,CAAC,CAAA;AACH,GAAA;EAEAX,OAAO,CAACmH,UAAU,EAAE,CAAA;AACtB,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASC,eAAeA,GAA8B;AAC3D,EAAA,MAAMpH,OAAO,GAAGG,UAAU,EAAE,CAAA;EAE5B,IAAI,CAACH,OAAO,EAAE;AACZ,IAAA,MAAM,IAAIW,KAAK,CACb,yFACF,CAAC,CAAA;AACH,GAAA;EAEA,OAAOyF,yBAAyB,CAACpG,OAAO,CAAC,CAAA;AAC3C,CAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASqH,6BAA6BA,CAC3CC,QAAoB,EAC4C;AAChE,EAAA,MAAMtH,OAAO,GAAGG,UAAU,EAAE,CAAA;EAE5B,IAAI,CAACH,OAAO,EAAE;AACZ,IAAA,MAAM,IAAIW,KAAK,CACb,yFACF,CAAC,CAAA;AACH,GAAA;AAEA,EAAA,OAAO4G,uCAAuC,CAACvH,OAAO,EAAEsH,QAAQ,CAAC,CAAA;AACnE,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASE,WAAWA,GAAmB;AAC5C,EAAA,MAAMxH,OAAO,GAAGG,UAAU,EAAE,CAAA;EAE5B,IAAI,CAACH,OAAO,EAAE;AACZ,IAAA,MAAM,IAAIW,KAAK,CACb,qFACF,CAAC,CAAA;AACH,GAAA;EAEA,OAAO2F,qBAAqB,CAACtG,OAAO,CAAC,CAAA;AACvC,CAAA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASyH,yBAAyBA,CACvCH,QAAoB,EACsB;AAC1C,EAAA,MAAMtH,OAAO,GAAGG,UAAU,EAAE,CAAA;EAE5B,IAAI,CAACH,OAAO,EAAE;AACZ,IAAA,MAAM,IAAIW,KAAK,CACb,qFACF,CAAC,CAAA;AACH,GAAA;AAEA,EAAA,OAAO+G,mCAAmC,CAAC1H,OAAO,EAAEsH,QAAQ,CAAC,CAAA;AAC/D,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASK,YAAYA,CAClCC,IAAO,EACPpG,OAA4B,GAAG,EAAE,EACP;EAC1B,MAAMxB,OAAO,GAAG4H,IAAuB,CAAA;;AAEvC;EACAC,UAAU,CAAC,IAAI,CAAC,CAAA;EAChBd,UAAU,CAAC/G,OAAO,CAAC,CAAA;AAEnB,EAAA,MAAMyB,YAAY,GAAGC,eAAe,CAAC1B,OAAO,CAAC,CAAA;AAC7CyB,EAAAA,YAAY,CAACoB,UAAU,CAACjB,IAAI,CAAC,cAAc,CAAC,CAAA;EAE5CwC,WAAW,CAAC0D,KAAK,GAAG,IAAI,CAAA;EAExBlC,eAAe,CAAC5F,OAAO,CAAC,CAAA;EAExB,OAAO6B,OAAO,CAACC,OAAO,EAAE,CACrBC,IAAI,CAAC,MAAM;AACV,IAAA,MAAMgG,WAAW,GAAGC,cAAc,EAAE,CAAA;AACpC,IAAA,IAAID,WAAW,EAAE;MACf,OAAOA,WAAW,CAACE,IAAI,EAAE,CAAClG,IAAI,CAAC,MAAM,EAAE,CAAC,CAAA;AAC1C,KAAA;AACA,IAAA,OAAA;AACF,GAAC,CAAC,CACDA,IAAI,CAAC,MAAM;IACV,MAAM;AAAEmG,MAAAA,QAAAA;AAAS,KAAC,GAAG1G,OAAO,CAAA;;AAE5B;AACA;AACA;AACA;AACA;AACA;AACA,IAAA,IAAI0G,QAAQ,EAAE;AACZ,MAAA,OAAOC,UAAU,CAAC,IAAI,EAAED,QAAQ,CAAC,CAAA;AACnC,KAAA;IAEA,OAAOC,UAAU,CAACH,cAAc,EAAE,EAAEI,WAAW,EAAE,CAAC,CAAA;AACpD,GAAC,CAAC,CACDrG,IAAI,CAAElB,KAAK,IAAK;AACfwH,IAAAA,MAAM,CAACC,cAAc,CAACtI,OAAO,EAAE,OAAO,EAAE;AACtCuI,MAAAA,YAAY,EAAE,IAAI;AAClBC,MAAAA,UAAU,EAAE,IAAI;AAChBC,MAAAA,KAAK,EAAE5H,KAAK;AACZ6H,MAAAA,QAAQ,EAAE,KAAA;AACZ,KAAC,CAAC,CAAA;AACFC,IAAAA,QAAQ,CAAC3I,OAAO,EAAEa,KAAK,CAAC,CAAA;AAExBwH,IAAAA,MAAM,CAACC,cAAc,CAACtI,OAAO,EAAE,KAAK,EAAE;AACpCuI,MAAAA,YAAY,EAAE,IAAI;AAClBC,MAAAA,UAAU,EAAE,IAAI;AAChB;AACAC,MAAAA,KAAKA,CAACG,GAAQ,EAAEH,KAAU,EAAW;AACnC,QAAA,MAAMI,GAAG,GAAGC,GAAG,CAAC,YAAY;AAC1B,UAAA,OAAOlI,GAAG,CAACZ,OAAO,EAAE4I,GAAG,EAAEH,KAAK,CAAC,CAAA;AACjC,SAAC,CAAC,CAAA;AACF,QAAA,OAAOI,GAAG,CAAA;OACX;AACDH,MAAAA,QAAQ,EAAE,KAAA;AACZ,KAAC,CAAC,CAAA;AAEFL,IAAAA,MAAM,CAACC,cAAc,CAACtI,OAAO,EAAE,eAAe,EAAE;AAC9CuI,MAAAA,YAAY,EAAE,IAAI;AAClBC,MAAAA,UAAU,EAAE,IAAI;AAChB;MACAC,KAAKA,CAACM,IAAS,EAAW;AACxB,QAAA,MAAMF,GAAG,GAAGC,GAAG,CAAC,YAAY;AAC1B,UAAA,OAAOE,aAAa,CAAChJ,OAAO,EAAE+I,IAAI,CAAC,CAAA;AACrC,SAAC,CAAC,CAAA;AAEF,QAAA,OAAOF,GAAG,CAAA;OACX;AACDH,MAAAA,QAAQ,EAAE,KAAA;AACZ,KAAC,CAAC,CAAA;AAEFL,IAAAA,MAAM,CAACC,cAAc,CAACtI,OAAO,EAAE,KAAK,EAAE;AACpCuI,MAAAA,YAAY,EAAE,IAAI;AAClBC,MAAAA,UAAU,EAAE,IAAI;MAChBC,KAAKA,CAACG,GAAW,EAAO;AACtB,QAAA,OAAOtI,GAAG,CAACN,OAAO,EAAE4I,GAAG,CAAC,CAAA;OACzB;AACDF,MAAAA,QAAQ,EAAE,KAAA;AACZ,KAAC,CAAC,CAAA;AAEFL,IAAAA,MAAM,CAACC,cAAc,CAACtI,OAAO,EAAE,eAAe,EAAE;AAC9CuI,MAAAA,YAAY,EAAE,IAAI;AAClBC,MAAAA,UAAU,EAAE,IAAI;AAChB;MACAC,KAAKA,CAAC,GAAGQ,IAAW,EAA2B;AAC7C,QAAA,OAAOC,aAAa,CAAClJ,OAAO,EAAEiJ,IAAI,CAAC,CAAA;OACpC;AACDP,MAAAA,QAAQ,EAAE,KAAA;AACZ,KAAC,CAAC,CAAA;AAEF,IAAA,IAAIS,MAAgE,CAAA;AACpEnJ,IAAAA,OAAO,CAAC,YAAY,CAAC,GAAG,SAASmH,UAAUA,GAAG;AAC5CnG,MAAAA,MAAM,CACJ,0DAA0D,EAC1D,CAAC,CAACmI,MACJ,CAAC,CAAA;AACDA,MAAAA,MAAM,EAAE,CAAA;AACRrC,MAAAA,MAAM,CAACK,UAAU,GAAGgC,MAAM,GAAG/I,SAAS,CAAA;KACvC,CAAA;AAEDJ,IAAAA,OAAO,CAAC,WAAW,CAAC,GAAG,SAASkH,SAASA,GAAG;AAC1CkC,MAAAA,OAAO,CAACC,IAAI,CAAC,iDAAiD,CAAC,CAAC;;AAEhE,MAAA,OAAO,IAAIxH,OAAO,CAAEC,OAAO,IAAK;AAC9BqH,QAAAA,MAAM,GAAGrH,OAAO,CAAA;QAChBgF,MAAM,CAACK,UAAU,GAAGA,UAAU,CAAA;AAChC,OAAC,CAAC,CAAA;KACH,CAAA;AAEDlD,IAAAA,eAAe,EAAE,CAAA;AAEjB,IAAA,OAAOjE,OAAO,CAAA;AAChB,GAAC,CAAC,CAAA;AACN;;;;"}