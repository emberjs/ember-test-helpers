{"version":3,"file":"tap.js","sources":["../../src/dom/tap.ts"],"sourcesContent":["import getElement from './-get-element.ts';\nimport fireEvent from './fire-event.ts';\nimport { __click__ } from './click.ts';\nimport settled from '../settled.ts';\nimport type { Target } from './-target.ts';\nimport { log } from './-logging.ts';\nimport isFormControl from './-is-form-control.ts';\nimport { runHooks, registerHook } from '../helper-hooks.ts';\nimport getDescription from './-get-description.ts';\n\nregisterHook('tap', 'start', (target: Target) => {\n  log('tap', target);\n});\n\n/**\n  Taps on the specified target.\n\n  Sends a number of events intending to simulate a \"real\" user tapping on an\n  element.\n\n  For non-focusable elements the following events are triggered (in order):\n\n  - `touchstart`\n  - `touchend`\n  - `mousedown`\n  - `mouseup`\n  - `click`\n\n  For focusable (e.g. form control) elements the following events are triggered\n  (in order):\n\n  - `touchstart`\n  - `touchend`\n  - `mousedown`\n  - `focus`\n  - `focusin`\n  - `mouseup`\n  - `click`\n\n  The exact listing of events that are triggered may change over time as needed\n  to continue to emulate how actual browsers handle tapping on a given element.\n\n  Use the `options` hash to change the parameters of the tap events.\n\n  @public\n  @param {string|Element|IDOMElementDescriptor} target the element, selector, or descriptor to tap on\n  @param {Object} options the options to be merged into the touch events\n  @return {Promise<void>} resolves when settled\n\n  @example\n  <caption>\n    Emulating tapping a button using `tap`\n  </caption>\n\n  tap('button');\n*/\nexport default function tap(\n  target: Target,\n  options: TouchEventInit = {},\n): Promise<void> {\n  return Promise.resolve()\n    .then(() => {\n      return runHooks('tap', 'start', target, options);\n    })\n    .then(() => {\n      if (!target) {\n        throw new Error(\n          'Must pass an element, selector, or descriptor to `tap`.',\n        );\n      }\n\n      const element = getElement(target);\n      if (!element) {\n        const description = getDescription(target);\n        throw new Error(\n          `Element not found when calling \\`tap('${description}')\\`.`,\n        );\n      }\n\n      if (isFormControl(element) && element.disabled) {\n        throw new Error(`Can not \\`tap\\` disabled ${element}`);\n      }\n\n      return fireEvent(element, 'touchstart', options)\n        .then((touchstartEv) =>\n          fireEvent(element as Element, 'touchend', options).then(\n            (touchendEv) => [touchstartEv, touchendEv] as const,\n          ),\n        )\n        .then(([touchstartEv, touchendEv]) =>\n          !touchstartEv.defaultPrevented && !touchendEv.defaultPrevented\n            ? __click__(element as Element, options)\n            : Promise.resolve(),\n        )\n        .then(settled);\n    })\n    .then(() => {\n      return runHooks('tap', 'end', target, options);\n    });\n}\n"],"names":["registerHook","target","log","tap","options","Promise","resolve","then","runHooks","Error","element","getElement","description","getDescription","isFormControl","disabled","fireEvent","touchstartEv","touchendEv","defaultPrevented","__click__","settled"],"mappings":";;;;;;;;;AAUAA,YAAY,CAAC,KAAK,EAAE,OAAO,EAAGC,MAAc,IAAK;AAC/CC,EAAAA,GAAG,CAAC,KAAK,EAAED,MAAM,CAAC,CAAA;AACpB,CAAC,CAAC,CAAA;;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASE,GAAGA,CACzBF,MAAc,EACdG,OAAuB,GAAG,EAAE,EACb;EACf,OAAOC,OAAO,CAACC,OAAO,EAAE,CACrBC,IAAI,CAAC,MAAM;IACV,OAAOC,QAAQ,CAAC,KAAK,EAAE,OAAO,EAAEP,MAAM,EAAEG,OAAO,CAAC,CAAA;AAClD,GAAC,CAAC,CACDG,IAAI,CAAC,MAAM;IACV,IAAI,CAACN,MAAM,EAAE;AACX,MAAA,MAAM,IAAIQ,KAAK,CACb,yDACF,CAAC,CAAA;AACH,KAAA;AAEA,IAAA,MAAMC,OAAO,GAAGC,UAAU,CAACV,MAAM,CAAC,CAAA;IAClC,IAAI,CAACS,OAAO,EAAE;AACZ,MAAA,MAAME,WAAW,GAAGC,cAAc,CAACZ,MAAM,CAAC,CAAA;AAC1C,MAAA,MAAM,IAAIQ,KAAK,CACb,CAAyCG,sCAAAA,EAAAA,WAAW,OACtD,CAAC,CAAA;AACH,KAAA;IAEA,IAAIE,aAAa,CAACJ,OAAO,CAAC,IAAIA,OAAO,CAACK,QAAQ,EAAE;AAC9C,MAAA,MAAM,IAAIN,KAAK,CAAC,CAA4BC,yBAAAA,EAAAA,OAAO,EAAE,CAAC,CAAA;AACxD,KAAA;AAEA,IAAA,OAAOM,SAAS,CAACN,OAAO,EAAE,YAAY,EAAEN,OAAO,CAAC,CAC7CG,IAAI,CAAEU,YAAY,IACjBD,SAAS,CAACN,OAAO,EAAa,UAAU,EAAEN,OAAO,CAAC,CAACG,IAAI,CACpDW,UAAU,IAAK,CAACD,YAAY,EAAEC,UAAU,CAC3C,CACF,CAAC,CACAX,IAAI,CAAC,CAAC,CAACU,YAAY,EAAEC,UAAU,CAAC,KAC/B,CAACD,YAAY,CAACE,gBAAgB,IAAI,CAACD,UAAU,CAACC,gBAAgB,GAC1DC,SAAS,CAACV,OAAO,EAAaN,OAAO,CAAC,GACtCC,OAAO,CAACC,OAAO,EACrB,CAAC,CACAC,IAAI,CAACc,OAAO,CAAC,CAAA;AAClB,GAAC,CAAC,CACDd,IAAI,CAAC,MAAM;IACV,OAAOC,QAAQ,CAAC,KAAK,EAAE,KAAK,EAAEP,MAAM,EAAEG,OAAO,CAAC,CAAA;AAChD,GAAC,CAAC,CAAA;AACN;;;;"}