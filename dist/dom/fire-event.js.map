{"version":3,"file":"fire-event.js","sources":["../../src/dom/fire-event.ts"],"sourcesContent":["import { isDocument, isElement } from './-target.ts';\nimport tuple from '../-tuple.ts';\nimport type { Target } from './-target.ts';\nimport { log } from './-logging.ts';\nimport { runHooks, registerHook } from '../helper-hooks.ts';\n\nregisterHook('fireEvent', 'start', (target: Target) => {\n  log('fireEvent', target);\n});\n\n// eslint-disable-next-line require-jsdoc\nconst MOUSE_EVENT_CONSTRUCTOR = (() => {\n  try {\n    new MouseEvent('test');\n    return true;\n  } catch {\n    return false;\n  }\n})();\nconst DEFAULT_EVENT_OPTIONS = { bubbles: true, cancelable: true };\n\nexport const KEYBOARD_EVENT_TYPES = tuple('keydown', 'keypress', 'keyup');\nexport type KeyboardEventType = (typeof KEYBOARD_EVENT_TYPES)[number];\n\n// eslint-disable-next-line require-jsdoc\nexport function isKeyboardEventType(\n  eventType: any,\n): eventType is KeyboardEventType {\n  return KEYBOARD_EVENT_TYPES.indexOf(eventType) > -1;\n}\n\nconst MOUSE_EVENT_TYPES = tuple(\n  'click',\n  'mousedown',\n  'mouseup',\n  'dblclick',\n  'mouseenter',\n  'mouseleave',\n  'mousemove',\n  'mouseout',\n  'mouseover',\n);\nexport type MouseEventType = (typeof MOUSE_EVENT_TYPES)[number];\n\n// eslint-disable-next-line require-jsdoc\nexport function isMouseEventType(eventType: any): eventType is MouseEventType {\n  return MOUSE_EVENT_TYPES.indexOf(eventType) > -1;\n}\n\nconst FILE_SELECTION_EVENT_TYPES = tuple('change');\nexport type FileSelectionEventType =\n  (typeof FILE_SELECTION_EVENT_TYPES)[number];\n\n// eslint-disable-next-line require-jsdoc\nexport function isFileSelectionEventType(\n  eventType: any,\n): eventType is FileSelectionEventType {\n  return FILE_SELECTION_EVENT_TYPES.indexOf(eventType) > -1;\n}\n\n// eslint-disable-next-line require-jsdoc\nexport function isFileSelectionInput(\n  element: any,\n): element is HTMLInputElement {\n  return element.files;\n}\n\nfunction fireEvent(\n  element: Element | Document | Window,\n  eventType: KeyboardEventType,\n  options?: any,\n): Promise<Event>;\n\nfunction fireEvent(\n  element: Element | Document | Window,\n  eventType: MouseEventType,\n  options?: any,\n): Promise<Event | void>;\n\nfunction fireEvent(\n  element: Element | Document | Window,\n  eventType: string,\n  options?: any,\n): Promise<Event>;\n\n/**\n  Internal helper used to build and dispatch events throughout the other DOM helpers.\n\n  @private\n  @param {Element} element the element to dispatch the event to\n  @param {string} eventType the type of event\n  @param {Object} [options] additional properties to be set on the event\n  @returns {Event} the event that was dispatched\n*/\nfunction fireEvent(\n  element: Element | Document | Window,\n  eventType: string,\n  options = {},\n): Promise<Event | void> {\n  return Promise.resolve()\n    .then(() => runHooks('fireEvent', 'start', element))\n    .then(() => runHooks(`fireEvent:${eventType}`, 'start', element))\n    .then(() => {\n      if (!element) {\n        throw new Error('Must pass an element to `fireEvent`');\n      }\n\n      let event;\n      if (isKeyboardEventType(eventType)) {\n        event = _buildKeyboardEvent(eventType, options);\n      } else if (isMouseEventType(eventType)) {\n        let rect;\n        if (element instanceof Window && element.document.documentElement) {\n          rect = element.document.documentElement.getBoundingClientRect();\n        } else if (isDocument(element)) {\n          rect = element.documentElement!.getBoundingClientRect();\n        } else if (isElement(element)) {\n          rect = element.getBoundingClientRect();\n        } else {\n          return;\n        }\n\n        const x = rect.left + 1;\n        const y = rect.top + 1;\n        const simulatedCoordinates = {\n          screenX: x + 5, // Those numbers don't really mean anything.\n          screenY: y + 95, // They're just to make the screenX/Y be different of clientX/Y..\n          clientX: x,\n          clientY: y,\n          ...options,\n        };\n\n        event = buildMouseEvent(eventType, simulatedCoordinates);\n      } else if (\n        isFileSelectionEventType(eventType) &&\n        isFileSelectionInput(element)\n      ) {\n        event = buildFileEvent(eventType, element, options);\n      } else {\n        event = buildBasicEvent(eventType, options);\n      }\n\n      element.dispatchEvent(event);\n      return event;\n    })\n    .then((event) =>\n      runHooks(`fireEvent:${eventType}`, 'end', element).then(() => event),\n    )\n    .then((event) => runHooks('fireEvent', 'end', element).then(() => event));\n}\n\nexport default fireEvent;\n\n// eslint-disable-next-line require-jsdoc\nfunction buildBasicEvent(type: string, options: any = {}): Event {\n  const event = document.createEvent('Events');\n\n  const bubbles = options.bubbles !== undefined ? options.bubbles : true;\n  const cancelable =\n    options.cancelable !== undefined ? options.cancelable : true;\n\n  delete options.bubbles;\n  delete options.cancelable;\n\n  // bubbles and cancelable are readonly, so they can be\n  // set when initializing event\n  event.initEvent(type, bubbles, cancelable);\n  for (const prop in options) {\n    (event as any)[prop] = options[prop];\n  }\n  return event;\n}\n\n// eslint-disable-next-line require-jsdoc\nfunction buildMouseEvent(type: MouseEventType, options: any = {}) {\n  let event;\n  const eventOpts: any = { view: window, ...DEFAULT_EVENT_OPTIONS, ...options };\n  if (MOUSE_EVENT_CONSTRUCTOR) {\n    event = new MouseEvent(type, eventOpts);\n  } else {\n    try {\n      event = document.createEvent('MouseEvents');\n      event.initMouseEvent(\n        type,\n        eventOpts.bubbles,\n        eventOpts.cancelable,\n        window,\n        eventOpts.detail,\n        eventOpts.screenX,\n        eventOpts.screenY,\n        eventOpts.clientX,\n        eventOpts.clientY,\n        eventOpts.ctrlKey,\n        eventOpts.altKey,\n        eventOpts.shiftKey,\n        eventOpts.metaKey,\n        eventOpts.button,\n        eventOpts.relatedTarget,\n      );\n    } catch {\n      event = buildBasicEvent(type, options);\n    }\n  }\n\n  return event;\n}\n\n// @private\n// eslint-disable-next-line require-jsdoc\nexport function _buildKeyboardEvent(\n  type: KeyboardEventType,\n  options: any = {},\n) {\n  const eventOpts: any = { ...DEFAULT_EVENT_OPTIONS, ...options };\n  let event: Event | undefined;\n  let eventMethodName: 'initKeyboardEvent' | 'initKeyEvent' | undefined;\n\n  try {\n    event = new KeyboardEvent(type, eventOpts);\n\n    // Property definitions are required for B/C for keyboard event usage\n    // If this properties are not defined, when listening for key events\n    // keyCode/which will be 0. Also, keyCode and which now are string\n    // and if app compare it with === with integer key definitions,\n    // there will be a fail.\n    //\n    // https://w3c.github.io/uievents/#interface-keyboardevent\n    // https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent\n    Object.defineProperty(event, 'keyCode', {\n      get() {\n        return parseInt(eventOpts.keyCode);\n      },\n    });\n\n    Object.defineProperty(event, 'which', {\n      get() {\n        return parseInt(eventOpts.which);\n      },\n    });\n\n    return event;\n  } catch {\n    // left intentionally blank\n  }\n\n  try {\n    event = document.createEvent('KeyboardEvents');\n    eventMethodName = 'initKeyboardEvent';\n  } catch {\n    // left intentionally blank\n  }\n\n  if (!event) {\n    try {\n      event = document.createEvent('KeyEvents');\n      eventMethodName = 'initKeyEvent';\n    } catch {\n      // left intentionally blank\n    }\n  }\n\n  if (event && eventMethodName) {\n    (event as any)[eventMethodName](\n      type,\n      eventOpts.bubbles,\n      eventOpts.cancelable,\n      window,\n      eventOpts.ctrlKey,\n      eventOpts.altKey,\n      eventOpts.shiftKey,\n      eventOpts.metaKey,\n      eventOpts.keyCode,\n      eventOpts.charCode,\n    );\n  } else {\n    event = buildBasicEvent(type, options);\n  }\n\n  return event;\n}\n\n// eslint-disable-next-line require-jsdoc\nfunction buildFileEvent(\n  type: FileSelectionEventType,\n  element: HTMLInputElement,\n  options: any = {},\n): Event {\n  const event = buildBasicEvent(type);\n  const files = options.files;\n\n  if (Array.isArray(options)) {\n    throw new Error(\n      'Please pass an object with a files array to `triggerEvent` instead of passing the `options` param as an array to.',\n    );\n  }\n\n  if (Array.isArray(files)) {\n    Object.defineProperty(files, 'item', {\n      value(index: number) {\n        return typeof index === 'number' ? this[index] : null;\n      },\n      configurable: true,\n    });\n    Object.defineProperty(element, 'files', {\n      value: files,\n      configurable: true,\n    });\n\n    const elementProto = Object.getPrototypeOf(element);\n    const valueProp = Object.getOwnPropertyDescriptor(elementProto, 'value');\n    Object.defineProperty(element, 'value', {\n      configurable: true,\n      get() {\n        return valueProp!.get!.call(element);\n      },\n      set(value) {\n        valueProp!.set!.call(element, value);\n\n        // We are sure that the value is empty here.\n        // For a non-empty value the original setter must raise an exception.\n        Object.defineProperty(element, 'files', {\n          configurable: true,\n          value: [],\n        });\n      },\n    });\n  }\n\n  Object.defineProperty(event, 'target', {\n    value: element,\n  });\n\n  return event;\n}\n"],"names":["registerHook","target","log","MOUSE_EVENT_CONSTRUCTOR","MouseEvent","DEFAULT_EVENT_OPTIONS","bubbles","cancelable","KEYBOARD_EVENT_TYPES","tuple","isKeyboardEventType","eventType","indexOf","MOUSE_EVENT_TYPES","isMouseEventType","FILE_SELECTION_EVENT_TYPES","isFileSelectionEventType","isFileSelectionInput","element","files","fireEvent","options","Promise","resolve","then","runHooks","Error","event","_buildKeyboardEvent","rect","Window","document","documentElement","getBoundingClientRect","isDocument","isElement","x","left","y","top","simulatedCoordinates","screenX","screenY","clientX","clientY","buildMouseEvent","buildFileEvent","buildBasicEvent","dispatchEvent","type","createEvent","undefined","initEvent","prop","eventOpts","view","window","initMouseEvent","detail","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","eventMethodName","KeyboardEvent","Object","defineProperty","get","parseInt","keyCode","which","charCode","Array","isArray","value","index","configurable","elementProto","getPrototypeOf","valueProp","getOwnPropertyDescriptor","call","set"],"mappings":"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"}