{"version":3,"file":"click.js","sources":["../../src/dom/click.ts"],"sourcesContent":["import { getWindowOrElement } from './-get-window-or-element.ts';\nimport fireEvent from './fire-event.ts';\nimport { __focus__ } from './focus.ts';\nimport settled from '../settled.ts';\nimport isFormControl from './-is-form-control.ts';\nimport { isWindow, type Target } from './-target.ts';\nimport { log } from './-logging.ts';\nimport { runHooks, registerHook } from '../helper-hooks.ts';\nimport getDescription from './-get-description.ts';\n\nconst PRIMARY_BUTTON = 1;\nconst MAIN_BUTTON_PRESSED = 0;\n\nregisterHook('click', 'start', (target: Target) => {\n  log('click', target);\n});\n\n/**\n * Represent a particular mouse button being clicked.\n * See https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/buttons for available options.\n */\nexport const DEFAULT_CLICK_OPTIONS = {\n  buttons: PRIMARY_BUTTON,\n  button: MAIN_BUTTON_PRESSED,\n};\n\n/**\n  @private\n  @param {Element} element the element to click on\n  @param {MouseEventInit} options the options to be merged into the mouse events\n  @return {Promise<Event | void>} resolves when settled\n*/\nexport function __click__(\n  element: Element | Document | Window,\n  options: MouseEventInit,\n): Promise<Event | void> {\n  return Promise.resolve()\n    .then(() => fireEvent(element, 'mousedown', options))\n    .then((mouseDownEvent) =>\n      !isWindow(element) && !mouseDownEvent?.defaultPrevented\n        ? __focus__(element)\n        : Promise.resolve(),\n    )\n    .then(() => fireEvent(element, 'mouseup', options))\n    .then(() => fireEvent(element, 'click', options));\n}\n\n/**\n  Clicks on the specified target.\n\n  Sends a number of events intending to simulate a \"real\" user clicking on an\n  element.\n\n  For non-focusable elements the following events are triggered (in order):\n\n  - `mousedown`\n  - `mouseup`\n  - `click`\n\n  For focusable (e.g. form control) elements the following events are triggered\n  (in order):\n\n  - `mousedown`\n  - `focus`\n  - `focusin`\n  - `mouseup`\n  - `click`\n\n  The exact listing of events that are triggered may change over time as needed\n  to continue to emulate how actual browsers handle clicking a given element.\n\n  Use the `options` hash to change the parameters of the [MouseEvents](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/MouseEvent).\n  You can use this to specify modifier keys as well.\n\n  @public\n  @param {string|Element|IDOMElementDescriptor} target the element, selector, or descriptor to click on\n  @param {MouseEventInit} _options the options to be merged into the mouse events.\n  @return {Promise<void>} resolves when settled\n\n  @example\n  <caption>\n    Emulating clicking a button using `click`\n  </caption>\n  click('button');\n\n  @example\n  <caption>\n    Emulating clicking a button and pressing the `shift` key simultaneously using `click` with `options`.\n  </caption>\n\n  click('button', { shiftKey: true });\n*/\nexport default function click(\n  target: Target,\n  _options: MouseEventInit = {},\n): Promise<void> {\n  const options = { ...DEFAULT_CLICK_OPTIONS, ..._options };\n\n  return Promise.resolve()\n    .then(() => runHooks('click', 'start', target, _options))\n    .then(() => {\n      if (!target) {\n        throw new Error(\n          'Must pass an element, selector, or descriptor to `click`.',\n        );\n      }\n\n      const element = getWindowOrElement(target);\n      if (!element) {\n        const description = getDescription(target);\n        throw new Error(\n          `Element not found when calling \\`click('${description}')\\`.`,\n        );\n      }\n\n      if (isFormControl(element) && element.disabled) {\n        throw new Error(`Can not \\`click\\` disabled ${element}`);\n      }\n\n      return __click__(element, options).then(settled);\n    })\n    .then(() => runHooks('click', 'end', target, _options));\n}\n"],"names":["PRIMARY_BUTTON","MAIN_BUTTON_PRESSED","registerHook","target","log","DEFAULT_CLICK_OPTIONS","buttons","button","__click__","element","options","Promise","resolve","then","fireEvent","mouseDownEvent","isWindow","defaultPrevented","__focus__","click","_options","runHooks","Error","getWindowOrElement","description","getDescription","isFormControl","disabled","settled"],"mappings":";;;;;;;;;;AAUA,MAAMA,cAAc,GAAG,CAAC,CAAA;AACxB,MAAMC,mBAAmB,GAAG,CAAC,CAAA;AAE7BC,YAAY,CAAC,OAAO,EAAE,OAAO,EAAGC,MAAc,IAAK;AACjDC,EAAAA,GAAG,CAAC,OAAO,EAAED,MAAM,CAAC,CAAA;AACtB,CAAC,CAAC,CAAA;;AAEF;AACA;AACA;AACA;AACO,MAAME,qBAAqB,GAAG;AACnCC,EAAAA,OAAO,EAAEN,cAAc;AACvBO,EAAAA,MAAM,EAAEN,mBAAAA;AACV,EAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACO,SAASO,SAASA,CACvBC,OAAoC,EACpCC,OAAuB,EACA;AACvB,EAAA,OAAOC,OAAO,CAACC,OAAO,EAAE,CACrBC,IAAI,CAAC,MAAMC,SAAS,CAACL,OAAO,EAAE,WAAW,EAAEC,OAAO,CAAC,CAAC,CACpDG,IAAI,CAAEE,cAAc,IACnB,CAACC,QAAQ,CAACP,OAAO,CAAC,IAAI,CAACM,cAAc,EAAEE,gBAAgB,GACnDC,SAAS,CAACT,OAAO,CAAC,GAClBE,OAAO,CAACC,OAAO,EACrB,CAAC,CACAC,IAAI,CAAC,MAAMC,SAAS,CAACL,OAAO,EAAE,SAAS,EAAEC,OAAO,CAAC,CAAC,CAClDG,IAAI,CAAC,MAAMC,SAAS,CAACL,OAAO,EAAE,OAAO,EAAEC,OAAO,CAAC,CAAC,CAAA;AACrD,CAAA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASS,KAAKA,CAC3BhB,MAAc,EACdiB,QAAwB,GAAG,EAAE,EACd;AACf,EAAA,MAAMV,OAAO,GAAG;AAAE,IAAA,GAAGL,qBAAqB;IAAE,GAAGe,QAAAA;GAAU,CAAA;EAEzD,OAAOT,OAAO,CAACC,OAAO,EAAE,CACrBC,IAAI,CAAC,MAAMQ,QAAQ,CAAC,OAAO,EAAE,OAAO,EAAElB,MAAM,EAAEiB,QAAQ,CAAC,CAAC,CACxDP,IAAI,CAAC,MAAM;IACV,IAAI,CAACV,MAAM,EAAE;AACX,MAAA,MAAM,IAAImB,KAAK,CACb,2DACF,CAAC,CAAA;AACH,KAAA;AAEA,IAAA,MAAMb,OAAO,GAAGc,kBAAkB,CAACpB,MAAM,CAAC,CAAA;IAC1C,IAAI,CAACM,OAAO,EAAE;AACZ,MAAA,MAAMe,WAAW,GAAGC,cAAc,CAACtB,MAAM,CAAC,CAAA;AAC1C,MAAA,MAAM,IAAImB,KAAK,CACb,CAA2CE,wCAAAA,EAAAA,WAAW,OACxD,CAAC,CAAA;AACH,KAAA;IAEA,IAAIE,aAAa,CAACjB,OAAO,CAAC,IAAIA,OAAO,CAACkB,QAAQ,EAAE;AAC9C,MAAA,MAAM,IAAIL,KAAK,CAAC,CAA8Bb,2BAAAA,EAAAA,OAAO,EAAE,CAAC,CAAA;AAC1D,KAAA;IAEA,OAAOD,SAAS,CAACC,OAAO,EAAEC,OAAO,CAAC,CAACG,IAAI,CAACe,OAAO,CAAC,CAAA;AAClD,GAAC,CAAC,CACDf,IAAI,CAAC,MAAMQ,QAAQ,CAAC,OAAO,EAAE,KAAK,EAAElB,MAAM,EAAEiB,QAAQ,CAAC,CAAC,CAAA;AAC3D;;;;"}